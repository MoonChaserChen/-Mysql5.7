# 事务的开启与提交
默认情况下Mysql是开启了事务的自动提交的：
```
mysql> show variables like 'autocommit';
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| autocommit    | ON    |
+---------------+-------+
```
## begin即时开启了事务？
| 连接1 | 连接2 |
| :----: | :----: |
| begin | - |
| - | SELECT * FROM information_schema.INNODB_TRX; |
| SELECT * FROM t1; | - |
| - | SELECT * FROM information_schema.INNODB_TRX; |
| commit; | - |

在连接1中使用begin去开启事务，同时在连接2中去查看是否开启了事务。
### 第一次执行结果：
```
mysql> SELECT * FROM information_schema.INNODB_TRX;
Empty set (0.00 sec)
```
### 第二次执行结果：
```
SELECT * FROM information_schema.INNODB_TRX;
+--------+-----------+---------------------+-----------------------+------------------+------------+---------------------+-----------+---------------------+-------------------+-------------------+------------------+-----------------------+-----------------+-------------------+-------------------------+---------------------+-------------------+------------------------+----------------------------+---------------------------+---------------------------+------------------+----------------------------+
| trx_id | trx_state | trx_started         | trx_requested_lock_id | trx_wait_started | trx_weight | trx_mysql_thread_id | trx_query | trx_operation_state | trx_tables_in_use | trx_tables_locked | trx_lock_structs | trx_lock_memory_bytes | trx_rows_locked | trx_rows_modified | trx_concurrency_tickets | trx_isolation_level | trx_unique_checks | trx_foreign_key_checks | trx_last_foreign_key_error | trx_adaptive_hash_latched | trx_adaptive_hash_timeout | trx_is_read_only | trx_autocommit_non_locking |
+--------+-----------+---------------------+-----------------------+------------------+------------+---------------------+-----------+---------------------+-------------------+-------------------+------------------+-----------------------+-----------------+-------------------+-------------------------+---------------------+-------------------+------------------------+----------------------------+---------------------------+---------------------------+------------------+----------------------------+
| 27910  | RUNNING   | 2020-01-10 10:25:49 | NULL                  | NULL             |          0 |                   5 | NULL      | NULL                |                 0 |                 0 |                0 |                  1136 |               0 |                 0 |                       0 | REPEATABLE READ     |                 1 |                      1 | NULL                       |                         0 |                         0 |                0 |                          0 |
+--------+-----------+---------------------+-----------------------+------------------+------------+---------------------+-----------+---------------------+-------------------+-------------------+------------------+-----------------------+-----------------+-------------------+-------------------------+---------------------+-------------------+------------------------+----------------------------+---------------------------+---------------------------+------------------+----------------------------+
1 row in set (0.00 sec)
```
结论： begin不会即时开启事务，而是在之后的增删改查等操作后才开启了一个事务。


## SAVEPOINT
savepoint 是在数据库事务处理中实现“子事务”（subtransaction），也称为嵌套事务的方法。
事务可以回滚到 savepoint 而不影响 savepoint 创建前的变化, 不需要放弃整个事务。

ROLLBACK 回滚的用法可以设置保留点 SAVEPOINT，执行多条操作时，回滚到想要的那条语句之前。

- 使用 SAVEPOINT

    SAVEPOINT savepoint_name;    // 声明一个 savepoint
- 回滚到 SAVEPOINT

    ROLLBACK TO savepoint_name;  // 回滚到savepoint
- 删除 SAVEPOINT

    1. 事务处理完成（执行一条 ROLLBACK 或 COMMIT）后自动释放。
    2. MySQL5 以来，可以用: `RELEASE SAVEPOINT savepoint_name;  // 删除指定保留点`
    